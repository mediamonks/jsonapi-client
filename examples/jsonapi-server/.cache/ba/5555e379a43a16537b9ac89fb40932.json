{"id":"../../new/lib/ResourceFilter.ts","dependencies":[{"name":"/Users/nathanuphoff/Projects/~lab/jsonapi-client/tsconfig.json","includedInParent":true,"mtime":1566390790929},{"name":"/Users/nathanuphoff/Projects/~lab/jsonapi-client/examples/jsonapi-server/package.json","includedInParent":true,"mtime":1566390790915}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ResourceFilter = void 0;\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ResourceFilter = function ResourceFilter(Resource, selection) {\n  _classCallCheck(this, ResourceFilter);\n\n  this.Resource = Resource;\n  this.fields = selection;\n  this.include = Object.values(Resource.fields).reduce(function (values, field) {\n    if (field.root === 'relationships' && field.type in selection) {\n      values.push(field.name);\n    }\n\n    return values;\n  }, []);\n};\n\nexports.ResourceFilter = ResourceFilter;"},"sourceMaps":{"js":{"mappings":[{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":26,"column":13},"generated":{"line":10,"column":4}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":34,"column":2},"generated":{"line":10,"column":21}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":34,"column":14},"generated":{"line":10,"column":45}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":34,"column":2},"generated":{"line":10,"column":53}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":34,"column":48},"generated":{"line":10,"column":55}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":34,"column":2},"generated":{"line":10,"column":64}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":34,"column":60},"generated":{"line":10,"column":66}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":34,"column":60},"generated":{"line":11,"column":0}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":35,"column":4},"generated":{"line":13,"column":0}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":35,"column":9},"generated":{"line":13,"column":7}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":35,"column":4},"generated":{"line":13,"column":15}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":35,"column":20},"generated":{"line":13,"column":18}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":35,"column":4},"generated":{"line":13,"column":26}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":36,"column":4},"generated":{"line":14,"column":0}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":36,"column":9},"generated":{"line":14,"column":7}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":36,"column":4},"generated":{"line":14,"column":13}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":36,"column":18},"generated":{"line":14,"column":16}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":36,"column":4},"generated":{"line":14,"column":25}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":37,"column":4},"generated":{"line":15,"column":0}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":37,"column":9},"generated":{"line":15,"column":7}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":37,"column":4},"generated":{"line":15,"column":14}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":37,"column":19},"generated":{"line":15,"column":17}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":37,"column":25},"generated":{"line":15,"column":23}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":37,"column":26},"generated":{"line":15,"column":24}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":37,"column":19},"generated":{"line":15,"column":30}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":37,"column":33},"generated":{"line":15,"column":31}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":37,"column":41},"generated":{"line":15,"column":39}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":37,"column":42},"generated":{"line":15,"column":40}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":37,"column":19},"generated":{"line":15,"column":46}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":37,"column":50},"generated":{"line":15,"column":48}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":37,"column":19},"generated":{"line":15,"column":54}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":38,"column":6},"generated":{"line":15,"column":55}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":38,"column":7},"generated":{"line":15,"column":65}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":38,"column":6},"generated":{"line":15,"column":71}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":38,"column":30},"generated":{"line":15,"column":73}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":38,"column":6},"generated":{"line":15,"column":78}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":38,"column":57},"generated":{"line":15,"column":80}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":39,"column":8},"generated":{"line":16,"column":0}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":40,"column":10},"generated":{"line":16,"column":8}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":40,"column":15},"generated":{"line":16,"column":13}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":40,"column":16},"generated":{"line":16,"column":14}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":40,"column":10},"generated":{"line":16,"column":18}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":40,"column":25},"generated":{"line":16,"column":23}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":40,"column":10},"generated":{"line":16,"column":38}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":41,"column":11},"generated":{"line":16,"column":42}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":41,"column":49},"generated":{"line":16,"column":47}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":41,"column":50},"generated":{"line":16,"column":48}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":41,"column":11},"generated":{"line":16,"column":52}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":41,"column":58},"generated":{"line":16,"column":56}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":39,"column":8},"generated":{"line":16,"column":65}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":42,"column":10},"generated":{"line":16,"column":67}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":43,"column":10},"generated":{"line":17,"column":0}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":43,"column":10},"generated":{"line":17,"column":6}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":43,"column":16},"generated":{"line":17,"column":12}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":43,"column":17},"generated":{"line":17,"column":13}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":43,"column":10},"generated":{"line":17,"column":17}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":43,"column":22},"generated":{"line":17,"column":18}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":43,"column":27},"generated":{"line":17,"column":23}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":43,"column":28},"generated":{"line":17,"column":24}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":43,"column":10},"generated":{"line":17,"column":28}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":44,"column":9},"generated":{"line":18,"column":0}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":45,"column":8},"generated":{"line":20,"column":0}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":45,"column":15},"generated":{"line":20,"column":11}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":45,"column":8},"generated":{"line":20,"column":17}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":46,"column":7},"generated":{"line":21,"column":0}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":37,"column":19},"generated":{"line":21,"column":3}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":47,"column":6},"generated":{"line":21,"column":5}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":37,"column":19},"generated":{"line":21,"column":7}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":37,"column":4},"generated":{"line":21,"column":8}},{"source":"../../new/lib/ResourceFilter.ts","name":null,"original":{"line":49,"column":3},"generated":{"line":22,"column":0}}],"sources":{"../../new/lib/ResourceFilter.ts":"import {\n  NonEmptyArray,\n  Nullable,\n  ObjectOf,\n  ValuesOf,\n  WithoutNever,\n} from '../declarations/util-types'\nimport { AnyResource, ResourceConstructor, ResourceType } from './Resource'\nimport { ResourceIdentifierKey } from './ResourceIdentifier'\nimport {\n  ResourceFieldNames,\n  ResourceFieldName,\n  AnyResourceRelationshipField,\n  AnyResourceField,\n  ResourceRelationshipFieldValue,\n} from './ResourceField'\n\nexport type AnyResourceFilter = ResourceFilter<AnyResource, any>\n\nexport type ResourceFilterOptions<M extends AnyResource> =\n  | ShallowResourceFilterOptions<M>\n  | ResourceFragmentFieldsB<M, M['type']>\n\nexport type ResourceFragmentX<F extends AnyResourceFilter> = F['Resource']\n\nexport class ResourceFilter<\n  R extends AnyResource,\n  S extends ResourceFilterOptions<R>\n> {\n  Resource: ResourceConstructor<R>\n  fields: S\n  include: Array<ResourceFieldName>\n\n  constructor(Resource: ResourceConstructor<R>, selection: S) {\n    this.Resource = Resource\n    this.fields = selection\n    this.include = Object.values(Resource.fields).reduce(\n      (values: Array<string>, field: AnyResourceField) => {\n        if (\n          field.root === 'relationships' &&\n          (field as AnyResourceRelationshipField).type in selection\n        ) {\n          values.push(field.name)\n        }\n        return values\n      },\n      [],\n    )\n  }\n}\n\ntype ShallowResourceFilterOptions<R extends AnyResource> = ObjectOf<\n  R['type'],\n  NonEmptyArray<ResourceFieldNames<R>>\n>\n\ntype ResourceFieldOptionsExcept<\n  R,\n  T extends ResourceType\n> = R extends AnyResource\n  ? R['type'] extends T\n    ? never\n    : ShallowResourceFilterOptions<R>\n  : never\n\ntype ResourceRelationshipsExcept<M, T extends ResourceType> = ValuesOf<\n  {\n    [K in keyof M]: M[K] extends Array<AnyResource>\n      ? ResourceFieldOptionsExcept<M[K][number], T>\n      : ResourceFieldOptionsExcept<Extract<M[K], AnyResource>, T>\n  }\n>\n\ntype ResourceFragmentFieldsB<M, T extends ResourceType> = M extends AnyResource\n  ?\n      | ResourceRelationshipsExcept<M, M['type']>\n      | ValuesOf<\n          { [K in keyof M]: ResourceFragmentFieldsC<M[K], T | M['type']> }\n        >\n  : never\n\ntype ResourceFragmentFieldsC<M, T extends ResourceType> = M extends AnyResource\n  ?\n      | ResourceRelationshipsExcept<M, M['type']>\n      | ValuesOf<\n          { [K in keyof M]: ResourceFragmentFieldsD<M[K], T | M['type']> }\n        >\n  : never\n\ntype ResourceFragmentFieldsD<M, T extends ResourceType> = M extends AnyResource\n  ?\n      | ResourceRelationshipsExcept<M, T | M['type']>\n      | ValuesOf<\n          { [K in keyof M]: ResourceFragmentFieldsE<M[K], T | M['type']> }\n        >\n  : never\n\ntype ResourceFragmentFieldsE<M, T extends ResourceType> = M extends AnyResource\n  ?\n      | ResourceRelationshipsExcept<M, T | M['type']>\n      | ValuesOf<\n          { [K in keyof M]: ResourceFragmentFieldsLimit<M[K], T | M['type']> }\n        >\n  : never\n\ntype ResourceFragmentFieldsLimit<M, T extends ResourceType> = never\n\n// RESOURCE FRAGMENT\ntype FilteredRelationshipField<T> = T extends AnyResource\n  ? Pick<T, ResourceIdentifierKey>\n  : T\n\ntype FilteredRelationshipFragment<\n  M extends AnyResource,\n  F extends { [key: string]: string }\n> = WithoutNever<\n  {\n    [K in keyof M]: K extends ResourceIdentifierKey\n      ? M[K]\n      : K extends F[M['type']]\n      ? M[K] extends Array<AnyResource>\n        ? Array<FilteredRelationshipField<M[K][any]>>\n        : FilteredRelationshipField<M[K]>\n      : never\n  }\n>\n\ntype FilteredResourceField<\n  T,\n  F extends { [key: string]: string }\n> = T extends Array<AnyResource>\n  ? Array<FilteredRelationshipFragment<T[number], F>>\n  : Extract<T, AnyResource> extends never\n  ? T\n  : Nullable<FilteredRelationshipFragment<Extract<T, AnyResource>, F>>\n\n// todo: check WithoutNever for ResourceFragment regression\nexport type FilteredResourceFragment<\n  M extends AnyResource,\n  F extends { [key: string]: string }\n> = WithoutNever<\n  {\n    [K in keyof M]: K extends ResourceIdentifierKey\n      ? M[K]\n      : K extends F[M['type']]\n      ? FilteredResourceField<M[K], F>\n      : never\n  }\n>\n\n// only get resource identifier object for relationships by default\nexport type DefaultResourceFragment<M extends AnyResource> = {\n  [K in keyof M]: Exclude<M[K], null> extends AnyResource\n    ? Nullable<Pick<Extract<M[K], AnyResource>, ResourceIdentifierKey>>\n    : M[K] extends Array<AnyResource>\n    ? Array<Pick<M[K][number], ResourceIdentifierKey>>\n    : M[K]\n}\n\nexport type ResourceFragment<\n  M extends AnyResource,\n  F extends Nullable<Record<string, any>>\n> = null extends F\n  ? DefaultResourceFragment<M>\n  : F extends {}\n  ? FilteredResourceFragment<M, { [K in keyof F]: F[K][number] }>\n  : never\n"},"lineCount":null}},"error":null,"hash":"72a26835cf45342e51fa7cdf9de80aca","cacheData":{"env":{}}}